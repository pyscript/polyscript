{"version":3,"file":"toml-V4Savzlc.js","sources":["../esm/3rd-party/toml.js"],"sourcesContent":["/* c8 ignore start */\n/*! (c) Andrea Giammarchi - ISC */\n\nconst {isArray} = Array;\nconst {parse: jsonParse} = JSON;\n\n/** @typedef {{s: string[], d: Date[]}} Foreign foreign strings and dates */\n\n/**\n * Transform quoted keys into regular keys.\n * @param {string} str the key to eventually normalize\n * @param {Foreign} foreign foreign strings and dates\n * @returns \n */\nconst getKey = (str, {s}) => str.replace(/\"s(\\d+)\"/g, (_, $1) => s[$1]);\n\n/**\n * Given a `'string'` or a `\"string\"` returns a JSON compatible string.\n * @param {string} str a TOML entry to parse\n * @param {Foreign} foreign foreign strings and dates\n * @returns {string}\n */\nconst getValue = (str, foreign) => jsonParse(\n  str.replace(/(\\S+?)\\s*=/g, '\"$1\":'),\n  (_, value) => typeof value === 'string' ?\n    foreign[value[0]][value.slice(1)] :\n    value\n);\n\n/**\n * Crawl the `json` object via the given array of keys and handle array entries.\n * @param {string[]} keys a path with all keys to reach the entry\n * @param {Foreign} foreign foreign strings and dates\n * @param {object} entry the root entry of the TOML\n * @param {boolean} asArray handle array entries\n * @returns {object} the current entry to handle\n */\nconst getPath = (keys, foreign, entry, asArray) => {\n  for (let i = 0, {length} = keys, last = length - 1; i < length; i++) {\n    const key = getKey(keys[i], foreign);\n    entry = entry[key] || (entry[key] = (asArray && (i === last) ? [] : {}));\n    if (isArray(entry)) {\n      if ((i === last) || !entry.length)\n        entry.push({});\n      entry = entry.at(-1);\n    }\n  }\n  return entry;\n};\n\n/**\n * Given a TOML text, removes stirngs and dates for easier parsing +\n * remove multi-line arrays to not need evaluation.\n * @param {string} toml the TOML text to map\n * @param {string[]} strings mapped strings\n * @param {Date[]} dates mapped Dates\n * @returns {[string, Foreign]}\n */\nconst mapForeign = (toml, strings, dates) => [\n  toml\n    // map strings in the TOML\n    .replace(\n      /([\"'])(?:(?=(\\\\?))\\2.)*?\\1/g,\n      value => `\"s${strings.push(value.slice(1, -1)) - 1}\"`\n    )\n    // map dates in the TOML\n    .replace(\n      /\\d{2,}([:-]\\d{2}){2}([ T:-][\\dZ:-]+)?/g,\n      value => `\"d${dates.push(new Date(value)) - 1}\"`\n    )\n    // avoid multi-line array entries\n    .replace(/([,[])\\s*[\\r\\n]+/g, '$1 ')\n    // TODO: this is probably not needed\n    .replace(/[\\r\\n]+\\s*]/g, ']')\n    // remove trailing commas\n    .replace(/,\\s*]/g, ']'),\n  {s: strings, d: dates}\n];\n\n/**\n * Given a simple subset of a TOML file, returns its JS equivalent.\n * @param {string} toml the TOML text to parse\n * @returns {object} the TOML equivalent as JSON serializable\n */\nconst parse = toml => {\n  const json = {}, [text, foreign] = mapForeign(toml, [], []);\n  let entry = json, line, match;\n  for (line of text.split(/[\\r\\n]+/)) {\n    if ((line = line.trim()) && line[0] !== '#') {\n      if ((match = /^(\\[+)(.*?)\\]+/.exec(line)))\n        entry = getPath(match[2].trim().split('.'), foreign, json, match[1] !== '[');\n      else if ((match = /^(\\S+?)\\s*=([^#]+)/.exec(line))) {\n        entry[getKey(match[1], foreign)] = getValue(match[2].trim(), foreign);\n      }\n    }\n  }\n  return json;\n};\n\nexport { parse };\n\n/* c8 ignore stop */\n"],"names":["isArray","Array","parse","jsonParse","JSON","getKey","str","s","replace","_","$1","getValue","foreign","value","slice","getPath","keys","entry","asArray","i","length","last","key","push","at","toml","json","text","strings","dates","Date","d","mapForeign","line","match","split","trim","exec"],"mappings":";AAGA,MAAMA,QAACA,GAAWC,OACXC,MAAOC,GAAaC,KAUrBC,EAAS,CAACC,GAAMC,OAAOD,EAAIE,QAAQ,YAAa,CAACC,EAAGC,IAAOH,EAAEG,IAQ7DC,EAAW,CAACL,EAAKM,IAAYT,EACjCG,EAAIE,QAAQ,cAAe,SAC3B,CAACC,EAAGI,IAA2B,iBAAVA,EACnBD,EAAQC,EAAM,IAAIA,EAAMC,MAAM,IAC9BD,GAWEE,EAAU,CAACC,EAAMJ,EAASK,EAAOC,KACrC,IAAK,IAAIC,EAAI,GAAGC,OAACA,GAAUJ,EAAMK,EAAOD,EAAS,EAAGD,EAAIC,EAAQD,IAAK,CACnE,MAAMG,EAAMjB,EAAOW,EAAKG,GAAIP,GAC5BK,EAAQA,EAAMK,KAASL,EAAMK,GAAQJ,GAAYC,IAAME,EAAQ,GAAK,CAAA,GAChErB,EAAQiB,KACLE,IAAME,GAAUJ,EAAMG,QACzBH,EAAMM,KAAK,IACbN,EAAQA,EAAMO,OAElB,CACA,OAAOP,GAqCHf,EAAQuB,IACZ,MAAMC,EAAO,IAAKC,EAAMf,GA3BP,EAACa,EAAMG,EAASC,IAAU,CAC3CJ,EAEGjB,QACC,8BACAK,GAAS,KAAKe,EAAQL,KAAKV,EAAMC,MAAM,GAAG,IAAO,MAGlDN,QACC,yCACAK,GAAS,KAAKgB,EAAMN,KAAK,IAAIO,KAAKjB,IAAU,MAG7CL,QAAQ,oBAAqB,OAE7BA,QAAQ,eAAgB,KAExBA,QAAQ,SAAU,KACrB,CAACD,EAAGqB,EAASG,EAAGF,IASmBG,CAAWP,EAAM,GAAI,IACxD,IAAkBQ,EAAMC,EAApBjB,EAAQS,EACZ,IAAKO,KAAQN,EAAKQ,MAAM,YACjBF,EAAOA,EAAKG,SAAuB,MAAZH,EAAK,MAC1BC,EAAQ,iBAAiBG,KAAKJ,IACjChB,EAAQF,EAAQmB,EAAM,GAAGE,OAAOD,MAAM,KAAMvB,EAASc,EAAmB,MAAbQ,EAAM,KACzDA,EAAQ,qBAAqBG,KAAKJ,MAC1ChB,EAAMZ,EAAO6B,EAAM,GAAItB,IAAYD,EAASuB,EAAM,GAAGE,OAAQxB,KAInE,OAAOc"}